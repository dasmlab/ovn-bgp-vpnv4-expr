# ovnkube-identity
# starts ovnkube-identity
# it is run on the master(s).
kind: DaemonSet
apiVersion: apps/v1
metadata:
  name: ovnkube-identity
  # namespace set up by install
  namespace: ovn-kubernetes
  annotations:
    kubernetes.io/description: |
      This DaemonSet launches the ovnkube-identity networking component on control-plane nodes.
spec:
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      name: ovnkube-identity
  updateStrategy:
    rollingUpdate:
      maxSurge: 100%
      maxUnavailable: 0
    type: RollingUpdate
  template:
    metadata:
      labels:
        app: ovnkube-identity
        name: ovnkube-identity
        component: network
        type: infra
        kubernetes.io/os: "linux"
    spec:
      priorityClassName: "system-cluster-critical"
      serviceAccountName: ovnkube-identity
      hostNetwork: true
      dnsPolicy: Default
      nodeSelector:
        node-role.kubernetes.io/control-plane: ""
        kubernetes.io/os: "linux"
      containers:
      - name: ovnkube-identity
        image: "ghcr.io/dasmlab/ovn-daemonset-fedora:dev"
        imagePullPolicy: "IfNotPresent"
        command: ["/root/ovnkube.sh", "ovnkube-identity"]
        securityContext:
          runAsUser: 0
        terminationMessagePolicy: FallbackToLogsOnError
        resources:
          requests:
            cpu: 100m
            memory: 300Mi
        volumeMounts:
          - mountPath: /etc/webhook-cert/
            name: webhook-cert
        env:
          - name: OVN_DAEMONSET_VERSION
            value: "1.1.0"
          - name: K8S_APISERVER
            valueFrom:
              configMapKeyRef:
                key: k8s_apiserver
                name: ovn-config
          - name: OVNKUBE_LOGLEVEL
            value: "4"
          - name: OVN_ENABLE_INTERCONNECT
            value: ""
          - name: OVN_HYBRID_OVERLAY_ENABLE
            value: ""
      volumes:
        - name: webhook-cert
          secret:
            secretName: ovnkube-webhook-cert
      tolerations:
      - operator: "Exists"

---
apiVersion: v1
kind: Secret
metadata:
  name: ovnkube-webhook-cert
  namespace: ovn-kubernetes
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZFekNDQXZ1Z0F3SUJBZ0lVTHVHRlE4RmptUWV1Wk1NQ1ZDUlFjcnZPQkJVd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0dURVhNQlVHQTFVRUF3d09jMlZzWmkxemFXZHVaV1F0WTJFd0hoY05NalV4TVRBMU1ETXpNekU1V2hjTgpNall4TVRBMU1ETXpNekU1V2pBVU1SSXdFQVlEVlFRRERBbHNiMk5oYkdodmMzUXdnZ0lpTUEwR0NTcUdTSWIzCkRRRUJBUVVBQTRJQ0R3QXdnZ0lLQW9JQ0FRREFSS3kySi9tcVJKcGpUV0JadkJlZjhiSkprRU5rbWNURXNYdkQKM1FUOG5CeUZGNkM5eFFSckZUK2l6TXZ4K1pPZzU1dEhXOERudXNvcm1URTVoS004WVpqNnpTVENONmVjWEdVUAo5SDgxMGt0NkY1eDdJMDlSc25CS1BFcTg2em4zKzVZcWFYN3BUcFVpZ1FhYldQRkNua0sySXhlVDBsdUErcGxzCkFoMGpyRVJpMGpiR2hSWEt2MjVsV1VhZmZQeWZCb0dEeTM1bGVKQWZqWTU5R21zWHgxaFdCOEdWQm9DSTVoOGoKSVg0d2pZR01DZ0pDeXlkdmU2aWZPWElTZDhlMitpblo4TzlFQkt6WExzd0MrcHlvZjJzcklaMndSOWdpQXNXbApWS0Y0cDZSdzlvVFlYbHh1Wi8zaDl1eGRTQnNTR29YT2FwcEJxRitPSURWMDV2WGNJK3haTW5NNzZsRnZhSmdJCnByOWUwbU9uZlJ6U3IxRVJXTkJpL2NQWFRlcW5sc3Nmak9IcU9PYWpoTmpkQmNLc3hjQUprSm9qb2ZSYk1IajAKNEtmWFdOSXF4S0FpQUV3VVNBcW1PcGV2UkxHSzVhbTNkbTNFZzExZDdPUGxuS1FIdnByNWcwSzNzV0xCelYzMQoycEF4UFg3QnRHdnhpM2Jnb1dBSCtrYW1FT0VvMkFnSy9UN1NnQ2xsZEMwM2ltR2VocHlRaytJOEdRSDhNSWw5CmZCZDArcU91NTlHdUhUd1NRUVRTTnR1eUpzbUgvVStaOU52TjdVWUwxUmRVT2R0NW53dlhBVEpwcHNCM2tONGYKeTkvZWxkV3k3cVkxR2hiVWluYmFRWGhXOE55dkJibXYzZDFSd3FoZWV0dm50Qy8zbmQyaHVhSFFoVktGT0RNKwpaRThzUVFJREFRQUJvMWd3VmpBVUJnTlZIUkVFRFRBTGdnbHNiMk5oYkdodmMzUXdIUVlEVlIwT0JCWUVGSVRoCnlnQnRuQkJ1TWI2RzRLQ1R4a2J0ekNVT01COEdBMVVkSXdRWU1CYUFGQXBkVWxrVTlDaXRodU9oeXJnenZIQmcKNGIxQ01BMEdDU3FHU0liM0RRRUJDd1VBQTRJQ0FRQmE3OGlSUTdpeUsyaDRwZGwyYk82aWp5c0dTUEFQNExoegpjdEJ2YW9SclBFRml5cVZlZTlkYTkvL0orQkYzREh6Ymk0Yk5JWjlYZFlsMnhFMGpUT0NrK2xBSk1paDhNajVyCmlsSXNnek5mUUo4WEtaQjY5VlJmNE1aaFhESEkvejZqUzNLdWY2b2JwaHUwTk9IcWxqRkpTWFJkMDd5emEzcnUKbTE2TEttMTJzOXZETDZLQ1o0ODI3UVk5bDVaOHNiNFdwSlhEVkYzT2l2R2I0VDB3aHgrQW5adlNyMGljdFc2UwpHWE5XY2o4TnR0elF3ZHBCTFpWQ3BHSXlzRVljdWozeEZQRFdFZit0RTBicm9JdkY3MWNGdDRVck1MQ2I0TzMyCjByVVdOMnpUdS9mcWhNS1NHdCtSczdxRGVaWFRodm9YVUdSZ05aWU1tNkRsQlR6Q2I0VlVVZkJpUUJPVWx6K1QKR3BGUkNzN3N6RUFLemlCWnIzVHB4ZTllYjU3QzZpVi9qd2ovcEVYdWZBb1gyRnp2eTBZdmpmZmpPMXp1TVMwZApVUkNUN2Q3V1ptQlpCUlFLY3NnQWh0Sytyanc3NkpDdGZSSW55blVYVlJsTWFPb3FHT003RzVMYW5ObzBLTWY5CkhtNmRIRk1uakM4VWpGQy9KRlV3Z0VxYmtIR0lCbzFjQ1VJOW1paWF2c25lUE9VK3pLRnAvOTFOR1dheVZjSmYKeWttQ0k3RlJBNUg2cGd2VlV5aG1mRFZhNWVaeGl1RG16VFFBSk1wT0FBRG5NTkhmSUxiMzJibWlqRHF4NGRsbQpsRWFBSTlacGsxSFUyaXRRWDVhSjBlbmVDNk5UNWxNcUJ5Sys4MU8wNm9MZWdrV216Q3Bxa3hubURaZGZ3clI0CkxzVkFxUitDaWc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUpSQUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQ1M0d2dna3FBZ0VBQW9JQ0FRREFSS3kySi9tcVJKcGoKVFdCWnZCZWY4YkpKa0VOa21jVEVzWHZEM1FUOG5CeUZGNkM5eFFSckZUK2l6TXZ4K1pPZzU1dEhXOERudXNvcgptVEU1aEtNOFlaajZ6U1RDTjZlY1hHVVA5SDgxMGt0NkY1eDdJMDlSc25CS1BFcTg2em4zKzVZcWFYN3BUcFVpCmdRYWJXUEZDbmtLMkl4ZVQwbHVBK3Bsc0FoMGpyRVJpMGpiR2hSWEt2MjVsV1VhZmZQeWZCb0dEeTM1bGVKQWYKalk1OUdtc1h4MWhXQjhHVkJvQ0k1aDhqSVg0d2pZR01DZ0pDeXlkdmU2aWZPWElTZDhlMitpblo4TzlFQkt6WApMc3dDK3B5b2Yyc3JJWjJ3UjlnaUFzV2xWS0Y0cDZSdzlvVFlYbHh1Wi8zaDl1eGRTQnNTR29YT2FwcEJxRitPCklEVjA1dlhjSSt4Wk1uTTc2bEZ2YUpnSXByOWUwbU9uZlJ6U3IxRVJXTkJpL2NQWFRlcW5sc3Nmak9IcU9PYWoKaE5qZEJjS3N4Y0FKa0pvam9mUmJNSGowNEtmWFdOSXF4S0FpQUV3VVNBcW1PcGV2UkxHSzVhbTNkbTNFZzExZAo3T1BsbktRSHZwcjVnMEszc1dMQnpWMzEycEF4UFg3QnRHdnhpM2Jnb1dBSCtrYW1FT0VvMkFnSy9UN1NnQ2xsCmRDMDNpbUdlaHB5UWsrSThHUUg4TUlsOWZCZDArcU91NTlHdUhUd1NRUVRTTnR1eUpzbUgvVStaOU52TjdVWUwKMVJkVU9kdDVud3ZYQVRKcHBzQjNrTjRmeTkvZWxkV3k3cVkxR2hiVWluYmFRWGhXOE55dkJibXYzZDFSd3FoZQpldHZudEMvM25kMmh1YUhRaFZLRk9ETStaRThzUVFJREFRQUJBb0lDQUFEbktReVJROE9VbFdhbTg1YkJoNk1hCjRBRnNCRWFNV1hzK2R0WWdlZ3YvNVhaUThHc2xsbHlEWW1ZNG41VWVQMW4xS1d6NHo0NEYwcHlyWWh3TXJkTUsKY2VxQVpDNUl5YjZpVGppcHYvZmpHMGJva25EYWRESWZlSUovTkgzMXdwOGxuN05jeXBjZTgrcWUrTExxQ1dMMApDUTNUV2l4Y09jT0ZJbVA2ZktQUkNiNEhUUTYvYmlVWTNsUmhMUG5VbFpOZlk3em5IMjQxYzljT3RoM2FRWjhuCnQ2YmF0SllZaDI3a2kzbDM1ZHVidFpucEJJSUwvWGxuWTN0NjRFS0YxQ1IvNklweXFhR2ZJTEVRR1dtYlVxcEwKMTZzUVVyZlN5QmZtekQwdGV1YVVhWmVCcjFnbWFTVnpOZGtxeFZmVk1hWDM4YzNrWTU5RCtNM1dTUURCUW9zMgpyRWsrdkVZS28zdXlqQUR2dkMzanpWSHoweHZNYVBXaDN6ZkpLMkZUTkphWTdUaUFpTzk3c042RHY1MW1IRXdyClNIWlZjanNXSWpSQThhZkhuTW95RHhhcHQ4L1BSaERRZVFRdkFDV1BnOUZGYzVWK0VnWWROT2JpV05WY2xiVzYKb3hzK09HUlBXZjFrN2l0ZS9iM09xdFdWMGYyWUFhNXVEWFBaczVjZVprSllndGJSVUlwRnVKa1M0UEpKMnRVbgpURWNPanQ5dzVtclBrN1l1R2lZVU4rOXVvZXZKK2tlUHpYOWJldWxKR0JDdVpHR3hpakIvUEpTYmdHVHY0YlRmCndiTTZ5cGJHQVJCalBvVG54WVJYRlhrdWZ0dHM3cktRdmNROE85OVJMSEVBY3VBOTB3cTlkd1ljeGpIai9NbTcKQXQ4cDlvNWhKWVJEbSsyOHdPYnhBb0lCQVFEeW5zdUpVWDVicGtjREl1dTY2ell4NHhsM2IwVjJiTkVkZkp2Zgpxc2xuQlFxNklhNlFkclJGcTZlL1JyaldRZS9hRjNtU2F4RytQNmhpTVZuUkx1T2M1RkJHTmF5cG5MNlNTaWhhCmFBajRUMzBJWW13cHhjbmJETkd3VUlYZEVkY1N6eHY2Zmw0TTNlYkt4clVYSzhQVjBVMVpTV0x5REJucmJCY3oKU01ydUZDUmJLOE1kU0xwWUZTLzZUL0V4T1ZhOTdlOFhnQlVXWWtFOEkwUlFEcnRSRURrUFNhejZsN2Z2WFBtWAorSmRwMzRDS1JGcVlRRlJlOWk2dkgrVEplYVErT3ZVS0dhc3RwRDlteVhtYldWb2lQQmpqOHBwdUNmNmROeUlPCmFFL1llekR0T0dNS2VpNFhidWVNMHFoL2N1eVFYa0tqMzFNTGlEOHVWSVM4d3VmcEFvSUJBUURLM3dnMllsWjYKZ3FLR2JvMkpEekExU2ZuaVQyb2xUcDFOaXN3ZktOQmd3VWF6VW5qSmNsaHhNNjNESUwzL2U0UFUwZ0ViRUtzTwo5RjlSRVFWSXpmOUwyeFV1TUtFZ05yRDJKUWpESXVvb242Y2MyZDczQVYyZVpvTnNucDd5MXVwZlVTLzVBUEl4ClNCUDRnazRFZW5YTVhEclNSRVFZei9jb01PWHkwYnMzNjNuYnMzWER2SWszUlNYMjNVL0thY1hrVUpyZlp5alkKdlMxM3UwZGk4WDVxVmY2RHhKUXVnRlRQNzFheUpVZGNENGhLN0pnRi91cklNb2ZmN0VvMmlXcVlIT3NXNXRGVgpicjlpdTRNNC9NbVlGR29aUWJ6SjI4UEtsV1JxMCtCSS82SWNvellTL05CTUV4ZWJqTnhWVExpT3UybzZGOS9hCk1zdVdrK0ptOU1LWkFvSUJBUUNqU2hTYW11cDhMSERtdjM0QUU0WXFGVHB5azhVZ2F5Uml3QmI0ZGkyTzFHbmYKMUFOMDN5OTlKSWFGeWNkbERJT3RPTmR0bi9vVkhTcnF5MlF6MFdjSGxQSWlEc1hpY2NnaEZTQUxtTEZRemM3TQo4ZER5WEZmNndhbnZESUxMd3RJSnFyS2Q2S2JMNmgwR3BLNEVwa1ByaUM2U3hUMSt3bjQvWUVSTkU5VGdYMVlJCnRtOWZLaStnVU1JMXFkQWUzUVJ3Vjg3dTloazdNMjNNVjhBR1VhUG9idzY0SjFId1ptUTVDVTVDNWVDaU5QYUMKR0hjUXVWc1Bmb2owL0hZeTAxZWpPbkxwRlZXTUpsczFocXY5emlsSG1VTDNSN1NBRXVIMlZjRHFDWEtUdEhXOQpjcEhWMzExZUVCcHZRT2grdm81UXErQVdBcHdWeXVFYkFXOUV5N2poQW9JQkFRQytybG1LdkcxcUl5VmQwOFdHCm9OY0FEM01tNnR2ckN2UkJjUWNnOW55OXBJeXVlZ0w3M1ZVUnViQkdLcDFLNkM1bU42bEFaaTlTRkJFUElqOWsKU2ZMK3VvSXk4eFJQTWZpc3N1eUVkV25BR3llNHIzT3BtUWdFblhoRC9PZUxlc082S1pZOHBrMytVakFyTVZiaApVTFV1Q3paaWNqWExXSldIbWtaWU1CZVhuT1hod2RFYjFEYm8wejYyeFJkOU9tUDlrR0d4UDhZZHlkcFZvcHFiCmZqOEM5YWNPOVJNT2ppS3BldDF5L2lVUGU2M3dObWRCbzNQTURlcTJadUx1VmNUeUNxUlExMHpFeng1bVQ3Y3MKTmpYSmtzNlN4TDRNd1ZwTExKWEE3enJ0Z2hFK2Q0MlkxVFYzZTY2Qnp5azlwNm9FeGxVM0d6K1ZXSThSRGhrTQpDbHhwQW9JQkFRQzNMRDI3cU55OGdTQkxWdkpKY3I1NWVFd3E0RXFFL3NDSXlnb2syNTMzNzk4Uk1ldG9IRXJQCm9EQklybWtDdjJtSTB4aVovbkNobUx4VGY0ZzJzV2R5c3prQkZOZzRhOFFPa1lnUWFnRlNySTBBVTNMZmsreGYKWGpPUjdzODNMelFlMlRadmpNTDhqbjh3RXRzZEk3T2ZvY3V5NG5GSnprN280eUZXNVVnUlBLTXJTL1JkNzNwUAo4ZUlXRUp0N3hra2V0ZW1ZRzhFRjF4Nzdid3FnemN1RmpLdUhsbGxMVmpieWV4UXd5UzNpZDI1Wk5WV29BV0g3Ckx6SlVUT3VIVWFOcFM1UzQ0aGI0UE1zcWhSTVZhaVVFZ0JjNW5KUGFqMWV0OU1GanpNSzFJVlZUcjlzQlFhMGUKdExzcG1xYjE1SGNKOExoREx0Y2tOcllwekJzVEswQTEKLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLQo=
type: kubernetes.io/tls

---
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  name: ovn-kubernetes-admission-webhook-node
webhooks:
  - name: ovn-kubernetes-admission-webhook-node.k8s.io
    clientConfig:
      url: https://localhost:9443/node
      caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZFekNDQXZ1Z0F3SUJBZ0lVS1FlUk15WjhlMVZmNDFwZ0IwUWN3MVhpbjVVd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0dURVhNQlVHQTFVRUF3d09jMlZzWmkxemFXZHVaV1F0WTJFd0hoY05NalV4TVRBMU1ETXpNekUzV2hjTgpNall4TWpFd01ETXpNekUzV2pBWk1SY3dGUVlEVlFRRERBNXpaV3htTFhOcFoyNWxaQzFqWVRDQ0FpSXdEUVlKCktvWklodmNOQVFFQkJRQURnZ0lQQURDQ0Fnb0NnZ0lCQU9UbTl0ZDlKZ0pXdWR4MkNwOXJaUVVpZERwODJXWnIKMEI2VFhVZVpXbnNidU56R01DcnE5M2dIYkNSaVlsNkNKK2d1SE8yb2w1ZEVDZDRuNnEzenFZcm44am1QTG1tbwpwbm41SkJUSTd4Z24xMndETFZvZ1VJWWd0b1JPZzA0aFVITEMzaGl1YUQ5MlhKalpIOWlKOW9rRmFlMktza04wCmdhNDYvNkxHYmhWdGxMbU1EZldEZE5JZEE0b1NkRThoaWRDdE1LcTUyZ0p5cGxrNml0Qnp6T1U1WTJCcGkvVUYKSXRpSlZybVM4SjJqeTJxSkdPbWdVK0w2VzNGUGhlVjJXOWdEdStQbVlDNmNTcGpsSWpFTEtRdWRWa01IZm9lbQpJVjIrR0Yzcno5UEZLTUtPbFhyZzYzVnBrakVhN1Q3YzlGTTdsSTV1OEVoVElUSmJjQnBxVjkxZCsvd1gzbFNGCjNzZ1Q2NHFHdUtRQWUyU09VcStMVW83aElCS0ZsUmovWFpmMkJQWmJqSUJYT2tmd1pNaUZkMkZlaDlvT0ZRUXoKVVdvTXJoeWJoV0hUZW1ZTUttR2IrcmdaTkNPVjhhZHV2c0xaTHB0cjdWaUdnMEh2bFE4cmdrZlVDYUhWaytrNgp3MHl2eC9XbUFkWkI2K0g0eVh5cG5jWVloZHkvdjc4Q016dWtOZXlHTDZKb0g4RzZqSy9wRFoxQVZPWkpXS3RrCmcxK3RSYzlXTzVBdE1iTndTT0M4eHg5eEY0dml5Tythc3IwdXh1MWw3KzJwY0pxQ0ZIdmlYSzBvbWgzd0NwL2YKcUJreDVZOWdXbWx5MnhUam9uc3IrT2ZzUzAybGZhWGtNQ1lsNVN6a25WSmNrYmlaTkFCZFFsWlcwWGhKNjdTYgpNNXF6RmNHbzdrVmJBZ01CQUFHalV6QlJNQjBHQTFVZERnUVdCQlFLWFZKWkZQUW9yWWJqb2NxNE03eHdZT0c5ClFqQWZCZ05WSFNNRUdEQVdnQlFLWFZKWkZQUW9yWWJqb2NxNE03eHdZT0c5UWpBUEJnTlZIUk1CQWY4RUJUQUQKQVFIL01BMEdDU3FHU0liM0RRRUJDd1VBQTRJQ0FRREQ3SmtFNGd1amYrN3MzWWhNVjJGNEtVRWgvb1ErckZGaApTNlhOVTVHQ1NGai9BWEFWZ1ZzYUlUbkpGNFBrRFdNV2Y3T0srbmd1eXBOMjFpUWdzeEZ6aU95Yk9jVlNTa043Cm9nNFdEdjVuNXZjWlN6bWhwTDhrdy9WakhldVQ3Tm5DK05zNUY5MUdJRUl2cURiNFNzWWhsK09hMjM1QTNTNW4KbFUxNnNrN0tROEdrSFVQazh1M3VibVQ3QThXME11cVZiYUhsYVFKVFJma0IxQjVQNWtxcDl1L2ZWOGREcVZYZwpJMVRCNTdVb2hWVy9LWEFxeHJQL1VVWHVPM0FwcHdaUkUwYzBsb0p0WkJtVzE2K0ZNVE9PZ0hnTDFwNnIxN01rCll2TGEzSXNZbGhaSjUzMkVKMlJQS0xEUkFlbzdpSVRRMERBam1xM29tMXVhTURBckVNdDRsd3dvUTY5NTR1dVcKajQ4NGFvaXNqM2VLempOYXlraHRHZWNsa3ZwZzhsbjEzWDJQUlV1QW50TGFWUXYzeitickY5SFFTY2xwaEpYdApSL0UxYWpJM05iQ2t6bkpIZWtTZUphbytJcG02V0MyQ3kwL1ZlcnNpUHQwbTRiNy9NRnNJcFpkRjZzcTJFdkpzCmNFMTlaT1BrdHg3M3pQQ3grS2FyZXo3UGNINTdoS1BNamlhWHBOdS8xTGhlb1B3Y1JHaitLeW5jK20wZmdFa2IKb0ZoZGRWWmdvOE0rOTgzYXppZjdnZm1id25WOTFPZHRheENTTFhFcmZvaVp1OXYvZHNpbjN0WGU1R0thY0NDbApkL0ppcnFFOER6cHc0YlpuUkNnL0tXc3ZkelhuY21KeDZhTXdyNEl4SUVNTXJSL1dqU0J5RDl1YUxHT3NZck51CnVwU2dXaTVEY0E9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    admissionReviewVersions: ['v1']
    sideEffects: None
    rules:
      - operations: [ "UPDATE" ]
        apiGroups: ["*"]
        apiVersions: ["*"]
        resources: ["nodes/status"] # Using /status subresource doesn't protect from other users changing the annotations
        scope: "*"

# in non-ic environments ovnkube-node doesn't have the permissions to update pods


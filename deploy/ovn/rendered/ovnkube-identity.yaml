# ovnkube-identity
# starts ovnkube-identity
# it is run on the master(s).
kind: DaemonSet
apiVersion: apps/v1
metadata:
  name: ovnkube-identity
  # namespace set up by install
  namespace: ovn-kubernetes
  annotations:
    kubernetes.io/description: |
      This DaemonSet launches the ovnkube-identity networking component on control-plane nodes.
spec:
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      name: ovnkube-identity
  updateStrategy:
    rollingUpdate:
      maxSurge: 100%
      maxUnavailable: 0
    type: RollingUpdate
  template:
    metadata:
      labels:
        app: ovnkube-identity
        name: ovnkube-identity
        component: network
        type: infra
        kubernetes.io/os: "linux"
    spec:
      priorityClassName: "system-cluster-critical"
      serviceAccountName: ovnkube-identity
      hostNetwork: true
      dnsPolicy: Default
      nodeSelector:
        node-role.kubernetes.io/control-plane: ""
        kubernetes.io/os: "linux"
      containers:
      - name: ovnkube-identity
        image: "ghcr.io/dasmlab/ovn-daemonset-fedora:dev"
        imagePullPolicy: "IfNotPresent"
        command: ["/root/ovnkube.sh", "ovnkube-identity"]
        securityContext:
          runAsUser: 0
        terminationMessagePolicy: FallbackToLogsOnError
        resources:
          requests:
            cpu: 100m
            memory: 300Mi
        volumeMounts:
          - mountPath: /etc/webhook-cert/
            name: webhook-cert
        env:
          - name: OVN_DAEMONSET_VERSION
            value: "1.1.0"
          - name: K8S_APISERVER
            valueFrom:
              configMapKeyRef:
                key: k8s_apiserver
                name: ovn-config
          - name: OVNKUBE_LOGLEVEL
            value: "4"
          - name: OVN_ENABLE_INTERCONNECT
            value: ""
          - name: OVN_HYBRID_OVERLAY_ENABLE
            value: ""
      volumes:
        - name: webhook-cert
          secret:
            secretName: ovnkube-webhook-cert
      tolerations:
      - operator: "Exists"

---
apiVersion: v1
kind: Secret
metadata:
  name: ovnkube-webhook-cert
  namespace: ovn-kubernetes
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZFekNDQXZ1Z0F3SUJBZ0lVVnU2ZExXZGhzMVB2Y3c0Rjh5OGhyajFjZ0dzd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0dURVhNQlVHQTFVRUF3d09jMlZzWmkxemFXZHVaV1F0WTJFd0hoY05NalV4TVRBMU1UQTFOakEwV2hjTgpNall4TVRBMU1UQTFOakEwV2pBVU1SSXdFQVlEVlFRRERBbHNiMk5oYkdodmMzUXdnZ0lpTUEwR0NTcUdTSWIzCkRRRUJBUVVBQTRJQ0R3QXdnZ0lLQW9JQ0FRREFkY3E0WW5HclE3cXdydWpBT0JudE5BSzlmWTNxTmdDRUpWa1MKWjhEdjFmZFg4VkJ2NUI0eHlwaHAzRUhvY0tuUzRIZnRjblNwM09MdzdjUWEzKzVBSm9CY1pDWUdmUUM1bCtGMQpSR2FKWXFpZlpkNlJIdytpUGwzbEFNMFN4Nm9DdkFiLzJETnhSZXZTYkc3Zm1DcktpWm45RTUwNTlybzFvcUNjCnVVbGpVVlNjbks4SE13aDYvMTVlQk5DMGxhakFybm9SSjlyUFoxajRXa3F6MEpVOENGQ3lZc0lraHhTbnE4ZGkKYmpVRS9aNmlRd2E5VVEvTENSdjN5OUVoZnhxTHYyM2QrUUZlQkM3WCtNS2l5MHExdnNUV29GdU8zZHNsVmIrOApVVDd1c0NzSk4vMlF6OTFqMUtFWmFaRGphYUVCb1N2SU1oQzcvNExpeVZ6VlBEdW1aZDg5T2FFb1A1M2lyaFFsCmMzRHBuWHpzMTVxUEV0a0xraTlUei9JMWJUQ2Y0M1RKSnB5VmN2QXhoVWdPYVVvZnROVVV6eHVEVlJuTlRJbngKeWFCRDdwWDNmTXJaRHVyaWFvd3NVWENXb2I1ZjdVWjB3Q0hqZ2l3bGVGN3Y4bGRzeFhMTFVyK25jclRzN292eQo4Y0pmcnJrM0ptOFdmUmZuTkVwUW9UTS9qQUpNQ0FnY1VZOGl6cmtkU0kvM2gwdExnZWg0M2hreXdRRU1KMDRFCmNpNk1ZbHY2STNSaGVyYlRZaEVpZDJEaEJQVUVOWm1FVjNqUkJ1MHRoeVJQMG1Jam1pV1ZJMlZlVkNXclMrek0KcVowMlRCci9TT2l4UmF1a2lZOXYvQlpmMTRGM3Nnc3lhckNEYS9Bei9iWU9oa1VEd2x3bEJkRWR0dUFmbTZoOAp4bU0wL3dJREFRQUJvMWd3VmpBVUJnTlZIUkVFRFRBTGdnbHNiMk5oYkdodmMzUXdIUVlEVlIwT0JCWUVGTFNjCjFtNjRTdTcvSGZ5NEdNMUdUVFA0RjJCdE1COEdBMVVkSXdRWU1CYUFGTSs0aUhkb3k3cFJWZDRBS1FWczBRTkIKR0JHK01BMEdDU3FHU0liM0RRRUJDd1VBQTRJQ0FRQTFlYXk4RS9PbXY2bzZPTU9McVJLMVJwOG9aSDgzWnR3RwpsVVBkdGdwdFFXZUtmbHg4Y0V3cmkweVNUaGRZRXNOd3NSTElraHNZbG92TXhsTkgyU2kyMnVsUGdnWEZRaHBOCnFpN3JCWU5HN1hDOHpjZXFGZE9LUXc0ZStLRTU2M0xNZHNkSFNkRW1IS2g1ald0U1dNVzZJY0JGS29uK0JXOTQKallQRERyRWd1bnJwNzV4TnJma09pR09zRlNHTERiaEoveG5SS3lma2FoNVNlY3RHV2NsdWk5d2d5N2FRN0lMQgpsTjdnMWl3bnl5Mnl4aS91dXl1Y0kxQ0x6Ym5waGJEVmcrQ2o3NnAyZGgwZDZGTkN2VDU0RXdXdjFhaDlDR1U3Cmo0VnFINlRGVm9mcjhTMldrWkdxTmp6MU5OM2J5dDdPY3VhVG9zVUd1WVBiOXZBUWlJNmI1Y0dZaE9valFoNUEKdlVwditCazdEc2NiZzV4UjJSdUd2NTY1RGQrZHloTW42UDNsK2pqYlNtamM4UXUrWG5wZk52cVhEcW9NV3JNVQpYUmt6YjZRVFJGM0luOWxORS9aRVFVbjh1Ti9aWUxQMkFwK1RvaWpiTlpYRlgxVzBrY2NKbndRTkphSElmMStoCmJkTk1nN2RiRjZUR2tQSXhGT1ZFRll5RVdJVldHZ0pzL01mWDZ1OXpOS1RzcExKUXZDY1ZQNEd6ZWsyS0lDclUKdnFIWFY0Q0poM09iMzc4U2VLV2ZkdERBbEtPT3ZyWXk1dkpHZUJGOTdVTjVReDVqK2FrTWs4alNFNkhYeHdmbApaay84VWpQS09pMngrVEhuQmJ5dzkvZWdkemltYnlnSnRUc1VTRnIvajZCRVQ2bVZ3NENjc3d5b3Q0MDBsdTlWCkUzVHRLQVNjYnc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUpRZ0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQ1N3d2dna29BZ0VBQW9JQ0FRREFkY3E0WW5HclE3cXcKcnVqQU9CbnROQUs5ZlkzcU5nQ0VKVmtTWjhEdjFmZFg4VkJ2NUI0eHlwaHAzRUhvY0tuUzRIZnRjblNwM09Mdwo3Y1FhMys1QUpvQmNaQ1lHZlFDNWwrRjFSR2FKWXFpZlpkNlJIdytpUGwzbEFNMFN4Nm9DdkFiLzJETnhSZXZTCmJHN2ZtQ3JLaVpuOUU1MDU5cm8xb3FDY3VVbGpVVlNjbks4SE13aDYvMTVlQk5DMGxhakFybm9SSjlyUFoxajQKV2txejBKVThDRkN5WXNJa2h4U25xOGRpYmpVRS9aNmlRd2E5VVEvTENSdjN5OUVoZnhxTHYyM2QrUUZlQkM3WAorTUtpeTBxMXZzVFdvRnVPM2RzbFZiKzhVVDd1c0NzSk4vMlF6OTFqMUtFWmFaRGphYUVCb1N2SU1oQzcvNExpCnlWelZQRHVtWmQ4OU9hRW9QNTNpcmhRbGMzRHBuWHpzMTVxUEV0a0xraTlUei9JMWJUQ2Y0M1RKSnB5VmN2QXgKaFVnT2FVb2Z0TlVVenh1RFZSbk5USW54eWFCRDdwWDNmTXJaRHVyaWFvd3NVWENXb2I1ZjdVWjB3Q0hqZ2l3bAplRjd2OGxkc3hYTExVcituY3JUczdvdnk4Y0pmcnJrM0ptOFdmUmZuTkVwUW9UTS9qQUpNQ0FnY1VZOGl6cmtkClNJLzNoMHRMZ2VoNDNoa3l3UUVNSjA0RWNpNk1ZbHY2STNSaGVyYlRZaEVpZDJEaEJQVUVOWm1FVjNqUkJ1MHQKaHlSUDBtSWptaVdWSTJWZVZDV3JTK3pNcVowMlRCci9TT2l4UmF1a2lZOXYvQlpmMTRGM3Nnc3lhckNEYS9BegovYllPaGtVRHdsd2xCZEVkdHVBZm02aDh4bU0wL3dJREFRQUJBb0lDQUQvVUVQcGJzOFVQL2s5d2dzS1ZHSXdoCmpyTVhlOFJzU25tSkJXUmtRb21JRmJMMTFpNTFva256SGQ4bDdEblJlNUR6WHZMQjNjMGo4NlBoeHdMK3R6NVIKUm9yZHIvckE1RWVwQmwzazVIaTEzcVNXblZ6VngxS1Fpb1ZUWWEvVHhoK0lDbTQ1WHI0M2FVRnRNc3cyNUNJdAp4b00zU1JLYk1DQnZvZ0s0TkkyYXdJdjhMdFFkYWJlWkQ4dndudUwxSzNWVHFDb2VaS1FhYTFoYVlhSUhFQ2RMCnZxK2Fyelo4RWk2VmV0ZTdJeHhYbkkvRjJPdGFnZmxkT1FoU2NUWkJ1Q1VXeExJMFRlN0hSbDNjSTNqb0lRdnIKaTg1K2VqOEVkeFNIdnNJTzArZEhSODZUNGlWdnVzWE1FKzJncEN1M3NXMGY3YXhFWm1aakZCNXdsN2drZE1kawpPVFhWcEpWZWFWRlg4OFVscW0xOVF6U2tCcWsrQXVRaDhMZ1BsVitnNWY4eGd4YVNyVk9zcFh2SlV4NWF4SVRlClJTQXVuREdnTStXSFpPOWExSmc5NW5GeDhQM01wTGhPa1UxYlo4U0VFQVRJY3hJZmF2OGUzM2lJM2R6QzB2UjgKMDJTd1FxWWtsbHpyZ0pFT1pUU1FzaTczdGxLNHFVL3dmRDFOV290UWIxUERhck9YcVdXT1BjNXRWNE9wbHBlRApaaUh3Rm01VG1GMUttdSsraHFTMUlZNXpVMHA0VitKUHdmUVljbnUzem1Bb0taa3k0K1dJT2h3TldGanBXWkVIClp4Uk0rQWdzVW9QejlXbzhrODBza1NzN2wzNTVwVWFmUTRHQzQ5L1hxZWxQdzV1TGxZWVF5Ry9uNDJtL0FsSkgKNURMcUpRMFFvOHlxcFd3c0Q2RWhBb0lCQVFEdG1yeVA3b3VNemhpYis1MzdxclVKWUM5c2Z3Vnpybnp3cDFBRQpkMHkwWVR6bmxUSG9NaTcxNmdHcm9IVTVMN3BXVE9XeHBaSlRhQTNMd3ZGV0hEZkQ0R1lqOXVrWmN2ejZpa2p1ClMxaW1KVHNyakdvYmd2cjU3ZHBMM1NoQUtYK082d2l1OFIwNkRzeWYya3hYVXlRSVV4cFRYTi9zakNickdDZUUKSThsT25uTzZ2S000K0xadFIrZThvTUZGamZPcHZzMWt1WVJzOVBzWFRNbnNlengzZlFLNVJWK2R5NVVEWEdhcApITmM2VTdqTGFzS29rSzlCUitScWVEdUhhanFxSnRVdmoxWEd1SDkveEZmbnZrZnhrUlhJSDB3MHFGNkFnT1ZlClZYT1piOHZRTlM1R0dwY2QrdTRPbSsxOXgwUkhGd05pNDhqQjhhTDhDR3B4cGErUkFvSUJBUURQWEU1RCtkWEEKbUkxaTBwQzFhaTRnczI2TWI3bXJSYzl2MURKS3NSWWl0bkJ6d3NHMUJnNnhscTFmaHZuNGxQejRMZHo2RFFlbQp5S0xtN0s3c3p3YmxhT2t5UXNNSGVKMkVKeHU4NGVVa1BSWXhmZjFINEtMbW1vWXowUXBMT3FyQVFURGFXUXdZCjNZTm1PSnh0WkRXRHd4VUtVY1p5b1BmcXUzeE8yVXcwR2VrY3pGKzd0Rnh2NmRXQlQ2YndJQTRyN3d1cUZZNCsKZkIxRzQ0SUx5b1k2eFh1NG15NVhoclZxdEhQaUVlaDZzS2RpZTRqZS9BSTBkYU9yWldzcE1jNnBITWFxWHd4SQpMNVJWNW5MVFpYb1FFcG5XZ0FvRTMxSy80SW5QaGg0Q3pjZ3RaUFFITExCS2NUZ2dSYitISjFEYm1UMzRpQjUyClprcWJucUFCZUhPUEFvSUJBUUM3OEU4Q0VnOXp1bmtndUMvSUpzaTN0OHNMS0pXcFlQVVdiV0VQaDBXMno4c2EKNnBubExmeVRLeHRUSThKVkQzbDJWYkRCaVZOcWdiMlgxSVNNTmhtdDU4c2kyMlNaYXFqTGk2SVFTcXkrRG1qMQpFMFhDcVNIWG10bTJkQ0lvVGlyRll3Y2xTVFp5KzgzREN5cWpUL0lLVzZGUkd2OUwzYmZTOFBJZ3hTV3YrQWxXClJXdGQzdXg5R0FrbTNJakRlWHFvWTNHWElGNnN5RUhydGlOcDJEaUYwdTNhbWhMOWYxQklya2ZOc0RCVnhHOUIKQnhzZHRnUEp3UkhkWFdqSXZhL1ZjbzNoNXFCVVpROEVnc3Q5VkxjWFRrbEtWK2N4SjVSSVZLd1lwOEtlTlIyagpmTTB6U2trSnY3ZVkrcUVwZ2ZweHVMUkcvaUdIdHBmU2Z0MmpNd2poQW9JQkFBNmdsVWpJUStMTklCUWJoR2UzCnNMOVB5UG1SSEFqUDZOMGJtOXlXOTFmRmhOTTFwdEp0TmZZakNlSFdOS1hyWkpqaEsxaGNPUER6OEVIWDZsTDgKRzZGdE1CNENoWjF1VGJZM3lBWWY3VGtNTWhlVnFwczZabU5iL1NHRW1uUktGQ2R4c2MrRlBvdzJmQUZtOXVuawppcjNic2cxRFRYdGlqWHA2ZFQ5ZXByaDZKMjZIb0MwdWdPTElITzU5UHVwcmFIU0M3VkMzS295UDFzVGNZWjBSClVUeXVGNWNqSXphN1l1cS9CZm1waDd1MzRHYmJEZ0dreDBjS0VWeVN6K2RkQXhYODJLckYvNmpMNm12UTBNTEcKd3NDRmYyS1pMNXUrWVNqMTN1TEx0Q3hBZGVGMTRKenM4eGFkTy9kUzFEcmxkQmU1akp5T2hZK1drYWErbnN6Ygp3Vk1DZ2dFQWJhN01xZEZTenNhbytGWU5UNkVtOE9oL3VkaTFQcVVxQTRVTWxLWVU0T2xNNmcvNE5QWFhkUFB3CjR2eW9oTngrUVhzNy85YmsrclREU3Y3TGx4WjR5YmpJTkdIWFZEcmJ4NkplT25LMVQyTUF6bjMzdk51WmFUUncKMVByWFg0K29hdG9FR2FBZXBod2JWd3pqR2NDWHVSc3B3akNQamhPT2E0M0kwZ3gzUWhVb09WUXpvMTA0REJMTwo4bnRmTzAxTXdiaVNIQTc2ckxWOFJZOU1TZkJkSUtzeFUzNnUyMzBobGFaNnFoaGdRbnBOdXVoTUJvV2ZiQjI0CnVLVjlGYlZVR1kvZjRXbkNVZmI4WUhvNVFPQVVBRlVMZWZZWklDVzNFcUUwNGtuOFIycXJzMFp5ejhqUmdCcjAKd2N3cHBZTUdkYVZoejhWS3BlRDYyLzBsSnB4QlhnPT0KLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLQo=
type: kubernetes.io/tls

---
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  name: ovn-kubernetes-admission-webhook-node
webhooks:
  - name: ovn-kubernetes-admission-webhook-node.k8s.io
    clientConfig:
      url: https://localhost:9443/node
      caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZFekNDQXZ1Z0F3SUJBZ0lVRkJ4L0ljQmlXUzJPUzkycEh3T0NhL1cxQVhBd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0dURVhNQlVHQTFVRUF3d09jMlZzWmkxemFXZHVaV1F0WTJFd0hoY05NalV4TVRBMU1UQTFOVFU1V2hjTgpNall4TWpFd01UQTFOVFU1V2pBWk1SY3dGUVlEVlFRRERBNXpaV3htTFhOcFoyNWxaQzFqWVRDQ0FpSXdEUVlKCktvWklodmNOQVFFQkJRQURnZ0lQQURDQ0Fnb0NnZ0lCQUtZaFkrL3ZsbkhuOXAvQzM4TVovaXZaWnpNRFVGZnAKZU0wZ0pHNWdDdkVSRFNvVFlxejFSSmN0WWJjZ3QzZUpYQU1CbWhkOUdsQURWckdsMEpLWjhwME5zd1NlL29Wbgp3OExTNWFRNHpRamR1NHNyOStKQ3F0ZENFZ2gxMnBFY29jczdrSVI0eTlONWhWbHkrWnNDK2s1RkZlWmpDQjd1CjJ2WDB2WEt0NDFXVGRxZEJYN2gycFNwUy9yWk9JZ3FNdWJra05QempxOC9FS3B4aFAxbUdXUGcwc0tPTFdLWHMKaC9JaUpoSEN0Zkl5aWFSaldpZzZUSXRlTW1TMXl5MXhod2NiVGxydnRVU25hWjlyaUdEY1lJR2k2TVNOVWlvYgpjSE5jSklVYmJtYmZhYWNOQ0srTXpzNGo3S2Q3RnlVWTJJME40bERCMnFxcXBBNmV4N0pEd1BYaS96ZUoxWUx4Cjd1SXRLOXR4OHpTYUt1dTR2NjdPMmJsQW1WR3Q5Z0FzVjZ5UXY2VFhERkpOdGx4OTZPRE0zVis3TU1iVUVrcnQKemEyQ1dtS0xwQlIvQVlHMkVIbVdKUE9obnY4ZHFlTXpNN2ZJckIweWdPSHNYYndHOWZXSElBdEU1bXVRb3ptNQo0NHZDRUN4aTVFQmJFWmlTYlVQWjcvMDJwenp6azN3U2dPVkRiNWtoZXU5aDV0MzZEWFY5NjJFdGZ2bUxLQUZMCktLN2hmZUtpeVczNUhiMlNRcm0rM254L2NmcTFEV2pKdHBNV1pLKzB6Q0ZwRHJ0MGVDVURTQjZwcFRseUZpY0IKY043K1NFTU5hVlY0aTBWZkZyNHdNRFloYmdBZTg3aXM4bERPTHkrOE5rS3g2SUZ4QXRUbGRyZmVPNjExbGNocgpkUG5Jd05GRXFKUGJBZ01CQUFHalV6QlJNQjBHQTFVZERnUVdCQlRQdUloM2FNdTZVVlhlQUNrRmJORURRUmdSCnZqQWZCZ05WSFNNRUdEQVdnQlRQdUloM2FNdTZVVlhlQUNrRmJORURRUmdSdmpBUEJnTlZIUk1CQWY4RUJUQUQKQVFIL01BMEdDU3FHU0liM0RRRUJDd1VBQTRJQ0FRQngzMDJNYjhZNE94WC8zSGVacmcycnVrNldWTTVYWEtubQoxbTZja3RnN0s2cG02cGxRN1NoeUQzaXBaMmNtNnNUTlF1allacjl0STJDazh3d3U4QUd5S0dUS1VWZVphYTNTCmNsamcrL3Y1aERZc1dlWkdKbXVzSWp4Vk1uSFY4UkFYbS9RN2YxTXVRc3h1SzEzZk0xZkUyY3NxR0c5eE9WQjQKSlhBUCtSNTdTRXQ4Yy9ZNm90RThWejNMdnZLRkQwWEc0d0RmVEcyeC9MS3dWU3JXZUI5dHRxN1ZYcEJ1b3NFQgpMU1l0SWxERUIxMmp6bDMzakpaOGpONGFvS3RSdXpDWnhXOGJQcURRQjFCNlBMRTJ2MkpISFVqUzN6TEcwc2ZmCk56aW5mMmNGTTdyYWh5b0FVNDl1RDhWYVNLU1I1U1NlRE9TeXhGckFNemtVZER6ZnpwakRFOGNKNUpxLzZYZTAKMEZRdlZhRzVJOW1ZZmlXbEVJUnZwbEd4NFk2NFF5anFEdXdhc0J6MTFlMGlyZzU0TzBxU1hpTTJUMmpQU2l3YwpIOGdKdHBQV0o1SkJBZXVybCtzRUt5OFFIWkE1UWJBakpKbHVBUGVtVjRlWm5TVEhBUldvaktydW5KTkFDWFpmCkVQTDJKRWVNVFdjZUFrdHBhRVFUTTJPS3Y2KzlGNUVmNTI4RFlWZy9pWHFxMytzWlQyQ2ZUOXY1TDB1bkp4SDIKNHUrdkNkcWczNVZjNWpScEJrM3hDdE00L2l3UlB1M2RIcGMyeEVackZ6aGFTZXA1R2FhRkdXbmE4dXlxcitZTwpmU3hodnYzYWorRDZXc0tFSzBabFU2MTlSaDRmcFNONXdJMXhIRDB2cWV4a09DZEpyelZBek1zbmxsNzJkSzd4CjZ4UkovY1VCU0E9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    admissionReviewVersions: ['v1']
    sideEffects: None
    rules:
      - operations: [ "UPDATE" ]
        apiGroups: ["*"]
        apiVersions: ["*"]
        resources: ["nodes/status"] # Using /status subresource doesn't protect from other users changing the annotations
        scope: "*"

# in non-ic environments ovnkube-node doesn't have the permissions to update pods

